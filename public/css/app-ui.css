/* (수정된 결과) */
/* ====== 모바일 우선 공통 ====== */
:root{
  --bg:#0c0f14; --card:#141922; --muted:#78819a; --text:#e8eefc;
  --acc:#6aa6ff; --acc2:#a77bff; --ok:#52d29a; --warn:#ffd166; --err:#ff6b6b;
  --radius:18px; --shadow:0 6px 24px rgba(0,0,0,.35);
  --maxw: 480px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:linear-gradient(180deg,#0b0f16,#111522 40%,#0b0f16);
  color:var(--text); font:14px/1.45 ui-sans-serif,system-ui,Apple SD Gothic Neo,Malgun Gothic,Segoe UI,Roboto;
}
.app-wrap{min-height:100%; display:flex; flex-direction:column; align-items:center;}
.app-center{width:100%; max-width:var(--maxw); padding-bottom:92px;}

/* ====== 카드 및 기본 UI 요소 ====== */
.card{
  background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
  overflow:hidden; position:relative;
}
.card.pad{padding:18px}

.world-card, .site-card, .character-card{
  position: relative;
  height: 180px;
  cursor: pointer;
  border-radius: var(--radius);
  overflow: hidden;
  contain: paint;
}
.world-card .bg, .site-card .bg, .character-card .bg{
  position: absolute;
  inset: 0;
  background: #222 center/cover no-repeat;
  filter: saturate(1.1) contrast(1.05);
  transition: transform .3s ease;
  pointer-events: none;
  transform: translateZ(0);
  backface-visibility: hidden;
}
.world-card:hover .bg, .site-card:hover .bg, .character-card:hover .bg {transform: scale(1.05);}

.world-card .grad, .site-card .grad, .character-card .grad{
  position:absolute; inset:auto 0 0 0; height:42%;
  background:linear-gradient(180deg, transparent, rgba(0,0,0,.6), rgba(0,0,0,.85));
}
.world-card .title, .site-card .title, .character-card .title{
  position:absolute; left:16px; right:16px; bottom:12px;
  font-size:16px; font-weight:700; letter-spacing:.2px;
  text-shadow:0 2px 10px rgba(0,0,0,.7);
}

.character-card .char-info{
  position: absolute;
  right: 12px;
  bottom: 12px;
  font-size: 12px;
  opacity: .9;
  background: rgba(0,0,0,.35);
  padding: 4px 8px;
  border-radius: 8px;
  backdrop-filter: blur(2px);
}

.grid3{display:grid; grid-template-columns:1fr; gap:12px; padding:0 16px 16px}

.list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
@media (min-width:420px){ .grid3{ grid-template-columns:repeat(2,1fr);} }
.create-card{min-height:110px; display:flex; flex-direction:column; gap:8px; align-items:flex-start; padding:16px; cursor:pointer;}
.create-card .icon{width:42px; height:42px; border-radius:12px; background:#1d2431; display:grid; place-items:center; color: var(--acc); margin-bottom: auto;}
.create-card .icon svg{width:22px; height:22px;}
.create-card .t{font-weight:700}
.create-card .s{color:var(--muted); font-size:12px; margin-top:2px}
.kv{display:flex; justify-content:space-between; gap:10px; padding:12px 16px;}
.kv:not(:last-child){border-bottom:1px solid rgba(255,255,255,.05)}
input[type="text"], textarea{
  width:100%; border-radius:12px; background:#0f1420; border:1px solid #273248; color:var(--text);
  padding:10px 12px; outline:none; transition:.2s border-color ease; font-family:inherit; font-size:14px;
}
input[type="text"]:focus, textarea:focus{border-color:#3a5a9d}
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  background:linear-gradient(135deg,var(--acc),var(--acc2));
  color:#fff; border:none; border-radius:12px; padding:12px 14px; font-weight:700;
  box-shadow:var(--shadow); cursor:pointer; transition:transform .12s ease, filter .12s ease; text-decoration: none;
}
.btn:active{transform:translateY(1px) scale(.99)}
.btn.secondary{background:#1d2431}
.btn.full{width:100%}

/* ====== 내비게이션 및 프레임 ====== */
#bottom-bar{
  position:fixed; left:50%; transform:translateX(-50%); bottom:14px;
  width:calc(min(var(--maxw), 100%) - 24px);
  background:rgba(16,21,31,.85);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px; box-shadow:0 20px 40px rgba(0,0,0,.5);
  backdrop-filter: blur(10px); z-index: 1000;
  padding: 8px 8px calc(8px + env(safe-area-inset-bottom));
  box-sizing: border-box;

}
.nav5{display:grid; grid-template-columns:repeat(5,1fr)}

.nav5 button{
    min-height: 56px;
  appearance:none; background:transparent; color:#8a98bb; border:0; padding:12px 8px;
  display:grid; place-items:center; gap:4px; cursor:pointer; transition: color .2s ease;
}
.nav5 button .ico{width:22px; height:22px; opacity:.9; transition:opacity .2s ease, transform .2s ease}
.nav5 button:hover { color: #fff; }
.nav5 button.active{color:#fff}
.nav5 button.active .ico{opacity:1; transform:scale(1.05)}
.nav5 .txt{font-size:11px}
#ui-blocker{
  position:fixed; inset:0; background:rgba(10,12,16,.66);
  display:none; align-items:center; justify-content:center; z-index:9999;
  backdrop-filter: blur(3px);
}
#ui-blocker.show{display:flex}
.spinner{width:42px; height:42px; border:3px solid rgba(255,255,255,.2); border-top-color:#fff; border-radius:50%; animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(3deg)}}
#auth-screen{min-height:100svh; display:grid; place-items:center; padding:22px}
.auth-card{max-width:360px; width:100%}
.section-h{padding:16px 16px 8px; font-size: 18px; font-weight:800; letter-spacing:.2px}
.small{color:var(--muted); font-size:12px}
.shadow-title{ text-shadow: 0 2px 10px rgba(0,0,0,.7);}

/* --- 캐러셀 UI --- */
.carousel-container { position: relative; padding: 0 16px; }
.hscroll {
  display: flex;
  overflow-x: auto;
  padding: 12px 0;
  scroll-snap-type: x mandatory;
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.hscroll::-webkit-scrollbar { display: none; }
.h-card {
  width: 100%;
  flex-shrink: 0;
  scroll-snap-align: center;
  margin-right: 12px;
}
.h-card:last-child { margin-right: 0; }
.carousel-dots { padding-top: 12px; display: flex; justify-content: center; gap: 8px; }
.dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255, 255, 255, 0.3); transition: background .3s ease; }
.dot.active { background: rgba(255, 255, 255, 0.8); }
.carousel-arrow {
  display: none; position: absolute; top: 90px;
  transform: translateY(-50%); background: rgba(0,0,0,.5);
  color: #fff; border: none; border-radius: 50%;
  width: 40px; height: 40px; font-size: 24px;
  cursor: pointer; z-index: 10;
}
.carousel-arrow.prev { left: -4px; }
.carousel-arrow.next { right: -4px; }
@media (min-width: 600px) { .carousel-arrow { display: block; } }

/* --- 상세 페이지 UI --- */
.like-btn {
  position: absolute; top: 10px; right: 10px;
  background: rgba(0,0,0,.5); color: #fff; border: none;
  border-radius: 999px; padding: 6px 10px; font-size: 12px;
  cursor: pointer; backdrop-filter: blur(4px);
}
.detail-header {
  height: 250px; position: relative; display: flex;
  align-items: flex-end; padding: 20px;
  background-size: cover; background-position: center;
}
.detail-header h2 { margin: 0; font-size: 24px; }
.detail-content { padding-bottom: 16px; }
.tab-content-wrapper { padding: 0; }
.detail-tabs-nav { display: flex; gap: 10px; margin: 0 16px 16px; border-bottom: 1px solid rgba(255,255,255,0.1); overflow-x: auto; }
.tab-btn {
  background: none; border: none; color: var(--muted);
  padding: 10px 4px; cursor: pointer; font-size: 15px;
  font-weight: 700; border-bottom: 2px solid transparent;
  transition: all .2s ease; flex-shrink: 0;
}
.tab-btn.active { color: var(--text); border-bottom-color: var(--acc); }
.info-card { background: var(--card); border-radius: var(--radius); padding: 16px; margin: 0 16px 12px; }
.info-card .name { font-weight: 700; font-size: 16px; margin-bottom: 8px; }
.info-card .desc { opacity: 0.8; line-height: 1.6; white-space: pre-wrap; }
.info-card.battle-log-card { cursor: pointer; }

/* --- 리치 텍스트 스타일 --- */
.narrative { margin: 1em 0; opacity: 0.9; line-height: 1.7; }
.dialogue {
  margin: 1em 0; padding: 12px 16px; background: rgba(0,0,0,0.2);
  border-left: 3px solid var(--acc2); font-style: italic; border-radius: 0 8px 8px 0;
}
.thought {
  margin: 1em 0; padding: 12px 16px; background: rgba(40, 48, 64, 0.3);
  border-left: 3px solid var(--muted); color: var(--muted); font-style: italic; border-radius: 0 8px 8px 0;
}
.system {
  margin: 1em 0; padding: 8px 12px; background: rgba(20, 25, 35, 0.5);
  border: 1px dashed rgba(255, 255, 255, 0.15); color: var(--acc);
  font-family: monospace; font-size: 13px; border-radius: 8px;
}
.emphasis { font-weight: 800; color: var(--warn); }

/* --- 애니메이션 --- */
@keyframes cardFadeIn { to { transform: translateY(0); opacity: 1; } }
.info-card, .tab-content > .grid3 {
  transform: translateY(10px);
  opacity: 0;
  animation: cardFadeIn 0.4s ease forwards;
}
.tab-content .info-card:nth-child(1) { animation-delay: 0.05s; }
.tab-content .info-card:nth-child(2) { animation-delay: 0.1s; }
.tab-content .info-card:nth-child(3) { animation-delay: 0.15s; }

.episode-card { cursor: pointer; transition: background-color .2s ease; }
.episode-card:hover { background-color: #1a212d; }
.episode-detail-view { animation: cardFadeIn .4s ease; }

/* --- 캐릭터 생성 UI --- */
.world-select-card {
  display: flex; align-items: center; gap: 16px; padding: 12px; cursor: pointer;
  border-radius: var(--radius); transition: background-color .2s ease; background-color: var(--card);
}
.world-select-card:hover { background-color: #1a212d; }
.world-select-card .image-box {
  width: 80px; height: 80px; flex-shrink: 0; border-radius: 14px;
  background-color: #222; background-size: cover; background-position: center;
}
.world-select-card .text-box { flex-grow: 1; }
.world-select-card .title { font-size: 16px; font-weight: 700; margin-bottom: 6px; }
.world-select-card .desc { font-size: 13px; color: var(--muted); line-height: 1.5; }

.prompt-select-card { cursor: pointer; transition: background-color .2s ease; }
.prompt-select-card:hover { background-color: #1a212d; }

/* --- 명소(Site) 카드 UI --- */
.site-admin-panel {
  margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.05);
}
select.select-box {
  width:100%; padding:10px; border-radius:12px; background:#0f1420;
  border:1px solid #273248; color:var(--text); font-family: inherit; font-size: 14px;
}

/* === 캐릭터 상세 페이지 === */
.char-hero{
  position:relative; aspect-ratio:1/1; border-radius:16px; overflow:hidden; margin:12px 16px;
  box-shadow: var(--shadow);
}
.char-hero .bg{
  position:absolute; inset:0; background:#222 center/cover no-repeat;
  transform: translateY(0); transition: transform .25s ease, opacity .25s ease;
  will-change: transform, opacity;
}
.char-hero .grad{ 
  position:absolute; 
  inset:0; 
  background:linear-gradient(180deg, transparent 40%, rgba(0,0,0,.6) 80%, rgba(0,0,0,.85) 100%); 
}
.char-hero .title{ position:absolute; left:16px; right:16px; bottom:12px; font-weight:700; font-size:18px; text-shadow:0 2px 10px rgba(0,0,0,.7); }

.tabs-char{ display:grid; grid-template-columns:repeat(4,1fr); gap:8px; padding:8px 16px; }
.tabs-char button{
  padding:10px 8px; border-radius:10px; background:rgba(30, 36, 50, 0.6);
  color:#a9b5d8; border: 1px solid rgba(170, 183, 255, 0.1);
  cursor:pointer; font-weight:700; transition: all .2s ease;
}
.tabs-char button.active{
  background:rgba(255,255,255,0.1); color:#fff;
  border-color: rgba(170, 183, 255, 0.3);
}

.tab-panels{ padding:0 16px 16px; }
.panel{ display:none; opacity:0; transform:translateY(6px); transition:opacity .12s ease, transform .12s ease; }
.panel.active{ display:block; opacity:1; transform:translateY(0); }

/* [수정] 서사 카드 대비 향상 */
.story-card{
  padding:14px; border-radius:14px; background:rgba(20, 26, 42, 0.9);
  border:1px solid rgba(170, 183, 255, 0.25); box-shadow: 0 6px 18px rgba(0,0,0,.25);
}

.skills-head{ display:flex; align-items:center; gap:8px; margin:6px 0 8px; }
.skills-head .count{ font-size:12px; opacity:.85; }

.skills-list.vlist{ display:flex; flex-direction:column; gap:10px; }
.skills-list.vlist .skill{ width:100%; }

/* [수정] 스킬 버튼 대비 향상 */
.skill{
  padding:12px; border-radius:12px; border:1px solid rgba(159, 180, 255, 0.3);
  background:rgba(25, 34, 56, 0.8); cursor:pointer; text-align:left;
  box-shadow: 0 6px 18px rgba(0,0,0,.25);
}
.skill.selected{
  outline:2px solid #88aaff; background:#18243b; box-shadow: 0 8px 22px rgba(23,105,255,.20);
  border-color: #88aaff;
}
.skill .small{ display:block; margin-top:6px; line-height:1.35; }

.slots{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin:10px 0 12px; }
.slot{ height:64px; border-radius:10px; background:#0b0f1a; border:1px dashed rgba(255, 255, 255, 0.19); display:flex; align-items:center; justify-content:center; }
.inventory.grid3{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
.item{ padding:8px; border-radius:10px; background:#12172a; border:1px solid rgba(255, 255, 255, 0.13); }
.item.in-slot{ background:#1a233a; }

.fab-battle{
  position:fixed; left:16px; right:auto; bottom:calc(96px + env(safe-area-inset-bottom));
  width:56px; height:56px; border-radius:50%; border:0; background:#ff4d67; color:#fff; font-size:22px;
  display:grid; place-items:center; box-shadow:0 8px 20px rgba(255,77,103,.35); z-index:1001;
  transition: transform 0.2s ease;
}
.fab-battle:active{ transform:translateY(1px) scale(.98); }

.rail{
  display:flex; gap:12px; overflow-x:auto; padding: 4px 2px 10px;
  scroll-snap-type:x mandatory; scrollbar-width: none;
}
.rail::-webkit-scrollbar { display: none; }
.rail > *{ flex:0 0 82%; scroll-snap-align:start; }
@media (min-width:420px){ .rail > *{ flex:0 0 48%; } }
@media (min-width:640px){ .rail > *{ flex:0 0 32%; } }

/* [수정] JS 코드 대신 CSS로 직접 스타일 추가 */
.modal-layer{
  position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);
  display:grid;place-items:center;z-index:1002;animation:fadeIn .2s ease;
}
.modal-card{
  max-width:720px;width:90%;max-height:80vh;overflow:auto;background:#0f1424;
  border:1px solid rgba(159, 180, 255, 0.2); border-radius:14px; padding:16px;
  box-shadow:0 20px 50px rgba(0,0,0,.5); animation:slideInUp .3s ease;
}
.modal-close{
  position:sticky; top:0; right:0; float:right; font-size:20px;
  background:transparent; border:0; color:#fff; cursor:pointer;
}
.modal-body{color:#e9eefb;}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

.compare-wrap{ padding:0 16px 12px; }
.compare-row{ display:grid; grid-template-columns:1fr; gap:12px; }
@media (min-width:520px){ .compare-row{ grid-template-columns:1fr 1fr; } }
.compare .cap{ font-size:12px; opacity:.85; margin-bottom:6px; }
.compare .hero{ height:160px; border-radius:12px; background:#121826 center/cover no-repeat; margin-bottom:8px; transition: transform 0.3s ease; }
.compare:hover .hero { transform: scale(1.03); }
.compare .name{ font-weight:800; font-size:16px; margin-bottom:4px; }
@media (min-width:520px){ .compare .hero{ height:200px; } }

.battle-log blockquote{ border-left:3px solid rgba(122, 162, 255, 0.4); padding-left:8px; margin:6px 0; color:#e9eefb; opacity:.95; font-style: italic; }
.battle-log code{ background:#111a2c; padding:2px 6px; border-radius:6px; }

.sim-loading{ display:grid; place-items:center; text-align:center; }
.sim-loading .dots span{ animation: blink 1.2s infinite; display:inline-block; }
.sim-loading .dots span:nth-child(2){ animation-delay:.2s }
.sim-loading .dots span:nth-child(3){ animation-delay:.4s }
@keyframes blink{ 0%,60%,100%{ opacity:.2 } 30%{ opacity:1 } }

.md-body{ color:#e9eefb; line-height:1.6 }
.md-body h3{ margin:12px 0 6px }
.md-body p{ margin:8px 0 }
.md-body blockquote{ border-left:3px solid rgba(122, 162, 255, 0.4); padding-left:8px; color:#e9eefb; opacity:.95; }
.md-body code{ background:#111a2c; padding:2px 6px; border-radius:6px }

.winner-badge{
  display:inline-block; margin-bottom:8px; padding:6px 10px;
  border-radius:10px; background:#1a233a; border:1px solid rgba(136, 170, 255, 0.35); font-weight:800;
}

.err {
    background-color: rgba(255, 107, 107, 0.1);
    border-left: 3px solid var(--err);
    color: #ffc2c2;
}

.info-card .desc, .story-card div {
  color: #e8eefc; /* 기본 텍스트 색상과 동일하게 조정 */
  opacity: 1; /* 투명도 제거 */
}

/* [수정] 서사 카드 세로 배열 및 텍스트 생략 처리 */
.story-cards.v-list {
  display: flex;
  flex-direction: column; /* 세로 배열 */
  gap: 12px;
  padding: 0 16px;
}
.story-card {
  padding: 14px;
  border-radius: 14px;
  background: rgba(20, 26, 42, 0.9);
  border: 1px solid rgba(170, 183, 255, 0.25);
  box-shadow: 0 6px 18px rgba(0,0,0,.25);
}
.story-card .story-content {
  display: -webkit-box;
  -webkit-line-clamp: 2; /* 두 줄까지 표시 */
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis; /* ... 처리 */
}
.story-card .story-title {
  font-weight: 700;
  margin-bottom: 6px;
  opacity: .9;
}


span.ok { color: var(--ok); }
span.err { color: var(--err); }


/* --- [추가] 스킬창 가시성 개선 --- */
.skill div[style*="font-weight:700"] {
  color: #FFFFFF; /* 스킬 이름을 흰색으로 */
}
.panel.skills .btn {
  color: #FFFFFF !important; /* 저장 버튼 텍스트를 흰색으로 강제 */
}

/* --- [추가] 배틀 로그 카드 스타일 (캐릭터 카드처럼) --- */
.battle-log-char-card {
  position: relative;
  height: 140px; /* 카드 세로 크기 조정 */
  border-radius: var(--radius);
  overflow: hidden;
  contain: paint;
  display: flex;
  flex-direction: column;
  justify-content: flex-end; /* 내용을 아래쪽에 정렬 */
  padding: 12px 16px;
  box-sizing: border-box;
}
.battle-log-char-card .bg {
  position: absolute;
  inset: 0;
  background: #222 center/cover no-repeat;
  filter: saturate(1.1) contrast(1.05) brightness(0.8);
  transform: translateZ(0);
  backface-visibility: hidden;
}
.battle-log-char-card .grad {
  position: absolute;
  inset: auto 0 0 0;
  height: 80%;
  background: linear-gradient(180deg, transparent, rgba(0,0,0,.6), rgba(0,0,0,.85));
}
.battle-log-char-card .info-overlay {
  position: relative;
  z-index: 2;
  color: #fff;
  text-shadow: 0 2px 10px rgba(0,0,0,.7);
}
.battle-log-char-card .opponent-name {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 6px;
}
.battle-log-char-card .result-line {
  font-size: 14px;
  font-weight: 700;
  margin-bottom: 4px;
}
.battle-log-char-card .date {
  font-size: 12px;
  opacity: .8;
}

/* --- [추가] 아이템 탭 버튼 가시성 개선 --- */
.panel.items .btn {
  color: #FFFFFF !important; /* 저장, 슬롯 비우기 버튼 텍스트를 흰색으로 */
}

/* --- [추가] 탭 패널 컨텐츠 애니메이션 --- */
.panel .v-list, .panel .grid3 {
  animation: cardFadeIn 0.5s ease forwards;
}

/* --- [추가] 관리 탭 스타일 --- */
.admin-panel-section {
  margin-bottom: 12px;
}
.admin-panel-section .small {
  margin-bottom: 8px;
  font-weight: 700;
}
.btn-danger {
    background: linear-gradient(135deg, #ff6b6b, #d93d3d);
}
